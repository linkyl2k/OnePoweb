{% extends "base.html" %}
{% block content %}
<div class="container my-5">
  <!-- ×›×•×ª×¨×ª -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">ğŸ“Š {{ t('dashboard_title') }}</h2>
      <p class="text-muted mb-0">{{ t('dashboard_subtitle') }}</p>
    </div>
    <a class="btn btn-primary" href="{{ url_for('index') }}">
      <i class="bi bi-plus-lg"></i> {{ t('dashboard_upload_new') }}
    </a>
  </div>

  <!-- ×›×¨×˜×™×¡×™ ×¡×™×›×•× -->
  <div class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white shadow h-100">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 opacity-75">{{ t('dashboard_total_sales') }}</h6>
          <h2 class="card-title mb-0">â‚ª{{ "{:,.0f}".format(total_sales) }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white shadow h-100">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 opacity-75">{{ t('dashboard_saved_reports') }}</h6>
          <h2 class="card-title mb-0">{{ total_reports }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white shadow h-100">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 opacity-75">{{ t('dashboard_avg_daily') }}</h6>
          <h2 class="card-title mb-0">â‚ª{{ "{:,.0f}".format(latest_summary.get('avg_daily', 0)) }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-dark shadow h-100">
        <div class="card-body text-center">
          <h6 class="card-subtitle mb-2 opacity-75">{{ t('dashboard_plan') }}</h6>
          <h2 class="card-title mb-0">{{ user.plan|upper }}</h2>
        </div>
      </div>
    </div>
  </div>

  {% if comparison %}
  <!-- ×”×©×•×•××ª ×ª×§×•×¤×•×ª ××•×˜×•××˜×™×ª -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
      <h5 class="mb-0">ğŸ“ˆ {% if current_lang == 'he' %}×”×©×•×•××” ××•×˜×•××˜×™×ª: {{ comparison.get('report2_name', '××—×¨×•×Ÿ') }} ××•×œ {{ comparison.get('report1_name', '×§×•×“×') }}{% elif current_lang == 'en' %}Automatic Comparison: {{ comparison.get('report2_name', 'Latest') }} vs {{ comparison.get('report1_name', 'Previous') }}{% else %}ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ: {{ comparison.get('report2_name', 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹') }} vs {{ comparison.get('report1_name', 'ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹') }}{% endif %}</h5>
    </div>
    <div class="card-body">
      <div class="row g-4">
        <!-- ×ª×§×•×¤×” ×§×•×“××ª -->
        <div class="col-md-5">
          <div class="border rounded p-3 bg-light h-100">
            <h6 class="text-muted mb-2">{{ comparison.get('report1_name', ('×ª×§×•×¤×” ×§×•×“××ª' if current_lang == 'he' else 'Previous Period' if current_lang == 'en' else 'ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´')) }}</h6>
            <p class="h3 mb-1 text-primary">â‚ª{{ "{:,.0f}".format(comparison.period1.total) }}</p>
            <div class="d-flex gap-3 text-muted small">
              <span><i class="bi bi-calendar"></i> {{ comparison.period1.days }} {% if current_lang == 'he' %}×™××™×{% elif current_lang == 'en' %}days{% else %}Ğ´Ğ½ĞµĞ¹{% endif %}</span>
              <span><i class="bi bi-receipt"></i> {{ comparison.period1.transactions }} {% if current_lang == 'he' %}×¢×¡×§××•×ª{% elif current_lang == 'en' %}transactions{% else %}Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹{% endif %}</span>
            </div>
          </div>
        </div>
        
        <!-- ×—×¥ ×”×©×•×•××” -->
        <div class="col-md-2 d-flex flex-column align-items-center justify-content-center">
          <i class="bi bi-arrow-left-right fs-3 text-muted mb-2"></i>
          {% if comparison.changes.total_pct > 0 %}
            <span class="badge bg-success fs-5 px-3 py-2">â†‘ {{ comparison.changes.total_pct }}%</span>
          {% elif comparison.changes.total_pct < 0 %}
            <span class="badge bg-danger fs-5 px-3 py-2">â†“ {{ comparison.changes.total_pct|abs }}%</span>
          {% else %}
            <span class="badge bg-secondary fs-5 px-3 py-2">= 0%</span>
          {% endif %}
        </div>
        
        <!-- ×ª×§×•×¤×” × ×•×›×—×™×ª -->
        <div class="col-md-5">
          <div class="border rounded p-3 h-100" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
            <h6 class="text-muted mb-2">{{ comparison.get('report2_name', ('×ª×§×•×¤×” ××—×¨×•× ×”' if current_lang == 'he' else 'Latest Period' if current_lang == 'en' else 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´')) }}</h6>
            <p class="h3 mb-1 text-success">â‚ª{{ "{:,.0f}".format(comparison.period2.total) }}</p>
            <div class="d-flex gap-3 text-muted small">
              <span><i class="bi bi-calendar"></i> {{ comparison.period2.days }} {% if current_lang == 'he' %}×™××™×{% elif current_lang == 'en' %}days{% else %}Ğ´Ğ½ĞµĞ¹{% endif %}</span>
              <span><i class="bi bi-receipt"></i> {{ comparison.period2.transactions }} {% if current_lang == 'he' %}×¢×¡×§××•×ª{% elif current_lang == 'en' %}transactions{% else %}Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹{% endif %}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ×ª×•×‘× ×” -->
      <div class="alert alert-info mt-3 mb-0">
        <i class="bi bi-lightbulb"></i> {{ comparison.insight }}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- ×¡×™× ×•×Ÿ ×œ×¤×™ ×¡×•×’ ×ª×§×•×¤×” -->
  <div class="card shadow-sm mb-4">
    <div class="card-body py-2">
      <div class="d-flex gap-2 flex-wrap align-items-center">
        <span class="text-muted me-2">{% if current_lang == 'he' %}×¡× ×Ÿ ×œ×¤×™:{% elif current_lang == 'en' %}Filter by:{% else %}Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾:{% endif %}</span>
        <a href="{{ url_for('dashboard') }}" 
           class="btn btn-sm {{ 'btn-primary' if not filter_type else 'btn-outline-secondary' }}">
          {% if current_lang == 'he' %}×”×›×œ{% elif current_lang == 'en' %}All{% else %}Ğ’ÑĞµ{% endif %} ({{ reports|length }})
        </a>
        {% for type_key, type_label in period_type_labels.items() %}
          {% set count = reports_by_type.get(type_key, [])|length %}
          {% if count > 0 %}
          <a href="{{ url_for('dashboard', period_type=type_key) }}" 
             class="btn btn-sm {{ 'btn-primary' if filter_type == type_key else 'btn-outline-secondary' }}">
            {{ type_label }} ({{ count }})
          </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- ×¨×©×™××ª ×“×•×—×•×ª -->
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">ğŸ“ {% if current_lang == 'he' %}×”×“×•×—×•×ª ×©×œ×™{% elif current_lang == 'en' %}My Reports{% else %}ĞœĞ¾Ğ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹{% endif %}</h5>
      {% if reports|length >= 2 %}
      <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#compareModal">
        <i class="bi bi-bar-chart"></i> {% if current_lang == 'he' %}×”×©×•×•×” ×ª×§×•×¤×•×ª{% elif current_lang == 'en' %}Compare Periods{% else %}Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹{% endif %}
      </button>
      {% endif %}
    </div>
    <div class="card-body p-0">
      {% if reports %}
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>{% if current_lang == 'he' %}×©× ×”×“×•×—{% elif current_lang == 'en' %}Report Name{% else %}ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°{% endif %}</th>
              <th>{% if current_lang == 'he' %}×¡×•×’{% elif current_lang == 'en' %}Type{% else %}Ğ¢Ğ¸Ğ¿{% endif %}</th>
              <th>{% if current_lang == 'he' %}×ª×§×•×¤×”{% elif current_lang == 'en' %}Period{% else %}ĞŸĞµÑ€Ğ¸Ğ¾Ğ´{% endif %}</th>
              <th>{% if current_lang == 'he' %}×¡×”"×› ××›×™×¨×•×ª{% elif current_lang == 'en' %}Total Sales{% else %}ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸{% endif %}</th>
              <th>{% if current_lang == 'he' %}×××•×¦×¢ ×™×•××™{% elif current_lang == 'en' %}Daily Avg{% else %}Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹{% endif %}</th>
              <th>{% if current_lang == 'he' %}× ×•×¦×¨{% elif current_lang == 'en' %}Created{% else %}Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½{% endif %}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for report in reports %}
            {% set summary = report.summary_json | fromjson if report.summary_json else {} %}
            <tr>
              <td><strong>{{ report.name }}</strong></td>
              <td>
                {% set pt = report.get('period_type', 'month') %}
                {% if pt == 'month' %}
                  <span class="badge bg-primary">{{ t('month') }}</span>
                {% elif pt == 'week' %}
                  <span class="badge bg-success">{{ t('week') }}</span>
                {% elif pt == 'day' %}
                  <span class="badge bg-info">{{ t('day') }}</span>
                {% else %}
                  <span class="badge bg-secondary">{{ t('custom') }}</span>
                {% endif %}
              </td>
              <td>
                {% if report.period_start and report.period_end %}
                  <small>{{ report.period_start }} â†’ {{ report.period_end }}</small>
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td><strong>â‚ª{{ "{:,.0f}".format(summary.get('total_sales', 0)) }}</strong></td>
              <td>â‚ª{{ "{:,.0f}".format(summary.get('avg_daily', 0)) }}</td>
              <td><small>{{ report.created_at[:10] if report.created_at else 'â€”' }}</small></td>
              <td>
                <form method="POST" action="{{ url_for('dashboard_delete_report', report_id=report.id) }}" 
                      onsubmit="return confirm('{% if current_lang == 'he' %}×œ××—×•×§ ××ª ×”×“×•×—?{% elif current_lang == 'en' %}Delete this report?{% else %}Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚?{% endif %}')" class="d-inline">
                  <button class="btn btn-outline-danger btn-sm" title="{{ t('delete') }}">ğŸ—‘ï¸</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-5 text-muted">
        <h4>{% if current_lang == 'he' %}××™×Ÿ ×“×•×—×•×ª ×©××•×¨×™× ×¢×“×™×™×Ÿ{% elif current_lang == 'en' %}No saved reports yet{% else %}ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¾Ğ²{% endif %}</h4>
        <p>{% if current_lang == 'he' %}×”×¢×œ×” ××ª ×”×“×•×— ×”×¨××©×•×Ÿ ×©×œ×š ×•×›×œ ×”× ×™×ª×•×—×™× ×™×™×©××¨×• ××•×˜×•××˜×™×ª{% elif current_lang == 'en' %}Upload your first report and all analyses will be saved automatically{% else %}Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚, Ğ¸ Ğ²ÑĞµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ñ‹ Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑŒÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸{% endif %}</p>
        <a class="btn btn-primary" href="{{ url_for('index') }}">{% if current_lang == 'he' %}×”×¢×œ×” ×“×•×—{% elif current_lang == 'en' %}Upload Report{% else %}Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡ĞµÑ‚{% endif %}</a>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- ×˜×™×¤ ×œ×©×™××•×© -->
  <div class="alert alert-light border mt-4">
    <div class="d-flex gap-3">
      <div class="fs-3">ğŸ’¡</div>
      <div>
        <strong>{% if current_lang == 'he' %}×˜×™×¤:{% elif current_lang == 'en' %}Tip:{% else %}Ğ¡Ğ¾Ğ²ĞµÑ‚:{% endif %}</strong> {% if current_lang == 'he' %}×”×¢×œ×” ×“×•×—×•×ª ××ª×§×•×¤×•×ª ×©×•× ×•×ª (×—×•×“×© ×©×¢×‘×¨, ×”×©×‘×•×¢ ×”×–×”) ×›×“×™ ×œ×¨××•×ª ×”×©×•×•××” ××•×˜×•××˜×™×ª!{% elif current_lang == 'en' %}Upload reports from different periods (last month, this week) to see automatic comparison!{% else %}Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ğ¹Ñ‚Ğµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹ Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ¾Ğ² (Ğ¿Ñ€Ğ¾ÑˆĞ»Ñ‹Ğ¹ Ğ¼ĞµÑÑÑ†, ÑÑ‚Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ!{% endif %}
        <br>
        <small class="text-muted">{% if current_lang == 'he' %}×‘×¢×ª ×”×¢×œ××ª ×“×•×—, ×‘×—×¨ ××ª ×¡×•×’ ×”×ª×§×•×¤×” (×—×•×“×©/×©×‘×•×¢/×™×•×) ×›×“×™ ×œ××¨×’×Ÿ ××ª ×”×”×©×•×•××•×ª.{% elif current_lang == 'en' %}When uploading a report, select the period type (month/week/day) to organize comparisons.{% else %}ĞŸÑ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° (Ğ¼ĞµÑÑÑ†/Ğ½ĞµĞ´ĞµĞ»Ñ/Ğ´ĞµĞ½ÑŒ), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ.{% endif %}</small>
      </div>
    </div>
  </div>

  <!-- ××‘×˜×—×ª ××™×“×¢ -->
  <div class="alert alert-secondary mt-3">
    <strong>ğŸ” {% if current_lang == 'he' %}××‘×˜×—×ª ××™×“×¢:{% elif current_lang == 'en' %}Data Security:{% else %}Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:{% endif %}</strong> {% if current_lang == 'he' %}×›×œ ×”× ×ª×•× ×™× ×©×œ×š ××•×¦×¤× ×™× ×‘×”×¦×¤× ×ª AES-256 (Fernet) ×•× ×©××¨×™× ×‘×¦×•×¨×” ×××•×‘×˜×—×ª. ×¨×§ ××ª×” ×™×›×•×œ ×œ×’×©×ª ×œ×“×•×—×•×ª ×©×œ×š.{% elif current_lang == 'en' %}All your data is encrypted with AES-256 (Fernet) encryption and stored securely. Only you can access your reports.{% else %}Ğ’ÑĞµ Ğ²Ğ°ÑˆĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ AES-256 (Fernet) Ğ¸ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ÑĞ²Ğ¾Ğ¸Ğ¼ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°Ğ¼.{% endif %}
  </div>
</div>

<!-- ××•×“×œ ×œ×”×©×•×•××ª ×ª×§×•×¤×•×ª -->
{% if reports|length >= 2 %}
<div class="modal fade" id="compareModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title"><i class="bi bi-bar-chart me-2"></i>{% if current_lang == 'he' %}×”×©×•×•××ª ×ª×§×•×¤×•×ª{% elif current_lang == 'en' %}Compare Periods{% else %}Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹{% endif %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{{ url_for('dashboard_compare') }}" id="compareForm">
        <div class="modal-body">
          <p class="text-muted mb-3">{% if current_lang == 'he' %}×‘×—×¨ ×©×ª×™ ×ª×§×•×¤×•×ª ×œ×”×©×•×•××”:{% elif current_lang == 'en' %}Select two periods to compare:{% else %}Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´Ğ²Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ:{% endif %}</p>
          <div class="mb-3">
            <label class="form-label fw-semibold">{% if current_lang == 'he' %}×ª×§×•×¤×” ×¨××©×•× ×” (×™×©× ×” ×™×•×ª×¨){% elif current_lang == 'en' %}First Period (older){% else %}ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ (ÑÑ‚Ğ°Ñ€ÑˆĞµ){% endif %}</label>
            <select name="report1_id" class="form-select" required>
              {% for report in reports %}
              {% set pt = report.get('period_type', 'month') %}
              <option value="{{ report.id }}">
                {{ report.name }} 
                {% if pt == 'month' %}ğŸ“…{% elif pt == 'week' %}ğŸ“†{% elif pt == 'day' %}ğŸ“Œ{% endif %}
                ({{ report.period_start or '?' }})
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">{% if current_lang == 'he' %}×ª×§×•×¤×” ×©× ×™×™×” (×—×“×©×” ×™×•×ª×¨){% elif current_lang == 'en' %}Second Period (newer){% else %}Ğ’Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ (Ğ½Ğ¾Ğ²ĞµĞµ){% endif %}</label>
            <select name="report2_id" class="form-select" required>
              {% for report in reports %}
              {% set pt = report.get('period_type', 'month') %}
              <option value="{{ report.id }}" {% if loop.first %}selected{% endif %}>
                {{ report.name }}
                {% if pt == 'month' %}ğŸ“…{% elif pt == 'week' %}ğŸ“†{% elif pt == 'day' %}ğŸ“Œ{% endif %}
                ({{ report.period_start or '?' }})
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="alert alert-info small mb-0">
            <i class="bi bi-info-circle"></i> {% if current_lang == 'he' %}××•××œ×¥ ×œ×”×©×•×•×ª ×ª×§×•×¤×•×ª ×××•×ª×• ×¡×•×’ (×—×•×“×© ××•×œ ×—×•×“×©, ×©×‘×•×¢ ××•×œ ×©×‘×•×¢){% elif current_lang == 'en' %}Recommended to compare periods of the same type (month vs month, week vs week){% else %}Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° (Ğ¼ĞµÑÑÑ† Ñ Ğ¼ĞµÑÑÑ†ĞµĞ¼, Ğ½ĞµĞ´ĞµĞ»Ñ Ñ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹){% endif %}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ t('cancel') }}</button>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-bar-chart me-1"></i> {% if current_lang == 'he' %}×”×©×•×•×”{% elif current_lang == 'en' %}Compare{% else %}Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<style>
  .card { border-radius: 12px; }
  .card-header { border-radius: 12px 12px 0 0 !important; }
  .badge { font-weight: 500; }
</style>
{% endblock %}
