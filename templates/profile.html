{% extends "base.html" %}
{% block content %}
<div class="container my-5" style="max-width: 1000px;">
  
  <!-- Profile Header -->
  <div class="card mb-4" style="border: none; background: linear-gradient(135deg, rgba(26,188,156,0.15) 0%, rgba(46,160,255,0.12) 100%), var(--bg-soft);">
    <div class="card-body py-4">
      <div class="d-flex flex-wrap align-items-center gap-4">
        <!-- Avatar -->
        <div class="profile-avatar" style="width: 80px; height: 80px; border-radius: 20px; background: linear-gradient(135deg, #1abc9c, #2ea0ff); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #fff; font-weight: bold; box-shadow: 0 8px 24px rgba(26,188,156,0.25);">
          {{ (user.first_name or user.email)[0]|upper }}
        </div>
        
        <!-- User Info -->
        <div class="flex-grow-1">
          <h3 class="mb-1" style="color: #fff;">
            {% if user.first_name %}
              {{ user.first_name }} {{ user.last_name or '' }}
            {% else %}
              {{ user.email.split('@')[0] }}
            {% endif %}
          </h3>
          <p class="mb-0 text-muted">{{ user.email }}</p>
        </div>
        
        <!-- Plan Badge -->
        <div class="text-center">
          {% if is_trial_active(user) %}
            <div class="plan-badge" style="background: linear-gradient(135deg, #f59e0b, #fbbf24); padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 16px rgba(245,158,11,0.3); position: relative;">
              <span style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: rgba(0,0,0,0.6);">{% if current_lang == 'he' %}×ª×§×•×¤×ª × ×™×¡×™×•×Ÿ{% elif current_lang == 'en' %}Trial Period{% else %}ĞŸÑ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´{% endif %}</span>
              <div style="font-size: 1.25rem; font-weight: bold; color: #000;">PRO</div>
              <div style="font-size: 0.7rem; color: rgba(0,0,0,0.7);">{% if current_lang == 'he' %}×¢×“{% elif current_lang == 'en' %}Until{% else %}Ğ”Ğ¾{% endif %} {{ user.trial_until }}</div>
            </div>
          {% elif user.plan == 'pro' %}
            <div class="plan-badge" style="background: linear-gradient(135deg, #10b981, #34d399); padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 16px rgba(16,185,129,0.3);">
              <span style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.8);">{{ t('current_plan') }}</span>
              <div style="font-size: 1.25rem; font-weight: bold; color: #fff;">PRO</div>
            </div>
          {% elif user.plan == 'basic' %}
            <div class="plan-badge" style="background: linear-gradient(135deg, #2ea0ff, #34c3ff); padding: 12px 24px; border-radius: 12px; box-shadow: 0 4px 16px rgba(46,160,255,0.3);">
              <span style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.8);">{{ t('current_plan') }}</span>
              <div style="font-size: 1.25rem; font-weight: bold; color: #fff;">BASIC</div>
            </div>
          {% else %}
            <div class="plan-badge" style="background: rgba(255,255,255,0.08); padding: 12px 24px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12);">
              <span style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted);">{{ t('current_plan') }}</span>
              <div style="font-size: 1.25rem; font-weight: bold; color: var(--text);">{{ t('plan_free') }}</div>
            </div>
          {% endif %}
</div>

        <!-- Edit Button -->
        <a class="btn btn-outline-secondary" href="{{ url_for('profile_edit') }}" style="border-radius: 10px;">
          <i class="bi bi-pencil me-1"></i> {{ t('edit') }}
        </a>
      </div>
    </div>
  </div>

  <div class="row g-4">
    
    <!-- Subscription Card -->
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex align-items-center gap-3 mb-4">
            <div style="width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, rgba(46,160,255,0.2), rgba(52,195,255,0.15)); display: flex; align-items: center; justify-content: center;">
              <i class="bi bi-credit-card" style="font-size: 1.25rem; color: #2ea0ff;"></i>
            </div>
            <h5 class="mb-0">{% if current_lang == 'he' %}× ×™×”×•×œ ×× ×•×™{% elif current_lang == 'en' %}Subscription Management{% else %}Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¾Ğ¹{% endif %}</h5>
          </div>

          <!-- Current Status -->
          <div class="mb-4 p-3" style="background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.06);">
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted">{{ t('profile_current_status') }}</span>
            {% if user.plan in ['basic','pro'] %}
              {% if not user.cancelled_at %}
                  <span class="badge" style="background: rgba(16,185,129,0.15); color: #34d399; padding: 6px 12px; border-radius: 8px;">
                    <i class="bi bi-check-circle me-1"></i>{{ t('profile_active') }}
                  </span>
              {% else %}
                  <span class="badge" style="background: rgba(239,68,68,0.15); color: #f87171; padding: 6px 12px; border-radius: 8px;">
                    <i class="bi bi-x-circle me-1"></i>{{ t('profile_cancelled') }}
                  </span>
              {% endif %}
            {% else %}
                <span class="badge" style="background: rgba(255,255,255,0.08); color: var(--muted); padding: 6px 12px; border-radius: 8px;">
                  {{ t('profile_no_subscription') }}
                </span>
              {% endif %}
            </div>
          </div>

          <!-- Trial Banner for Free Users -->
          {% if user.plan == 'free' and not user.trial_used and not is_trial_active(user) %}
            <div class="mb-3 p-3" style="background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(251,191,36,0.1)); border: 1px solid rgba(245,158,11,0.3); border-radius: 12px;">
              <div class="d-flex align-items-center gap-3">
                <div style="font-size: 2rem;">ğŸ</div>
                <div class="flex-grow-1">
                  <strong style="color: #fbbf24;">{{ t('profile_trial_available') }}</strong>
                  <p class="mb-0 small text-muted">
                    {% if current_lang == 'he' %}2 ×™××™× ×—×™× × - ××—×¨ ×›×š ×× ×•×™ PRO. ×œ× × ×“×¨×© ×›×¨×˜×™×¡ ××©×¨××™ ×œ× ×™×¡×™×•×Ÿ.{% elif current_lang == 'en' %}2 days free - then PRO subscription. No credit card required for trial.{% else %}2 Ğ´Ğ½Ñ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ - Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° PRO. Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ°.{% endif %}
                  </p>
                </div>
                <form method="POST" action="{{ url_for('start_trial') }}">
                  <button type="submit" class="btn" style="background: linear-gradient(90deg, #f59e0b, #fbbf24); color: #000; font-weight: 600; border-radius: 10px; padding: 10px 20px;">
                    {{ t('profile_start_trial') }}
                  </button>
                </form>
              </div>
            </div>
            {% endif %}

          <!-- Subscription Actions -->
          <div class="d-flex flex-column gap-2">
            <a class="btn w-100" href="{{ url_for('subscribe', plan='basic') }}" style="background: rgba(46,160,255,0.15); color: #2ea0ff; border: 1px solid rgba(46,160,255,0.3); border-radius: 10px; padding: 12px;">
              <i class="bi bi-star me-2"></i>
              {% if current_lang == 'he' %}×× ×•×™ BASIC â€” $15/×—×•×“×©{% elif current_lang == 'en' %}BASIC Subscription â€” $15/month{% else %}ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° BASIC â€” $15/Ğ¼ĞµÑÑÑ†{% endif %}
            </a>
            <a class="btn w-100" href="{{ url_for('subscribe', plan='pro') }}" style="background: linear-gradient(90deg, #10b981, #34d399); color: #fff; border: none; border-radius: 10px; padding: 12px; font-weight: 600;">
              <i class="bi bi-rocket-takeoff me-2"></i>
              {% if current_lang == 'he' %}×× ×•×™ PRO â€” $20/×—×•×“×©{% elif current_lang == 'en' %}PRO Subscription â€” $20/month{% else %}ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° PRO â€” $20/Ğ¼ĞµÑÑÑ†{% endif %}
            </a>

            {% if user.plan in ['basic','pro'] and not user.cancelled_at %}
              <form method="POST" action="{{ url_for('cancel_subscription') }}" onsubmit="return confirm('{% if current_lang == 'he' %}×”×× ×œ×‘×˜×œ ××ª ×”×× ×•×™?{% elif current_lang == 'en' %}Cancel subscription?{% else %}ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ?{% endif %}')">
                <button class="btn w-100" type="submit" style="background: transparent; color: #f87171; border: 1px solid rgba(239,68,68,0.3); border-radius: 10px; padding: 12px;">
                  <i class="bi bi-x-lg me-2"></i> {% if current_lang == 'he' %}×‘×˜×œ ×× ×•×™{% elif current_lang == 'en' %}Cancel Subscription{% else %}ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ{% endif %}
                </button>
              </form>
            {% elif user.plan in ['basic','pro'] and user.cancelled_at %}
              <form method="POST" action="{{ url_for('renew_subscription') }}">
                <button class="btn w-100" type="submit" style="background: rgba(16,185,129,0.15); color: #34d399; border: 1px solid rgba(16,185,129,0.3); border-radius: 10px; padding: 12px;">
                  <i class="bi bi-arrow-repeat me-2"></i> {% if current_lang == 'he' %}×—×™×“×•×© ×× ×•×™{% elif current_lang == 'en' %}Renew Subscription{% else %}ĞŸÑ€Ğ¾Ğ´Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ{% endif %}
                </button>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Account Settings Card -->
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex align-items-center gap-3 mb-4">
            <div style="width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(124,58,237,0.15)); display: flex; align-items: center; justify-content: center;">
              <i class="bi bi-gear" style="font-size: 1.25rem; color: #8b5cf6;"></i>
            </div>
            <h5 class="mb-0">{% if current_lang == 'he' %}×”×’×“×¨×•×ª ×—×©×‘×•×Ÿ{% elif current_lang == 'en' %}Account Settings{% else %}ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°{% endif %}</h5>
          </div>

          <div class="d-flex flex-column gap-3">
            <!-- Change Password -->
            <a href="{{ url_for('change_password') }}" class="d-flex align-items-center p-3 text-decoration-none" style="background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.06)'; this.style.borderColor='rgba(245,158,11,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.03)'; this.style.borderColor='rgba(255,255,255,0.06)';">
              <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(251,191,36,0.1)); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                <i class="bi bi-key" style="font-size: 1.1rem; color: #fbbf24;"></i>
              </div>
              <div class="flex-grow-1">
                <div style="color: var(--text); font-weight: 500;">{% if current_lang == 'he' %}×©×™× ×•×™ ×¡×™×¡××”{% elif current_lang == 'en' %}Change Password{% else %}Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ{% endif %}</div>
                <small class="text-muted">{% if current_lang == 'he' %}×¢×“×›×Ÿ ××ª ×”×¡×™×¡××” ×©×œ×š{% elif current_lang == 'en' %}Update your password{% else %}ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ{% endif %}</small>
              </div>
              <i class="bi bi-chevron-{{ 'left' if current_lang == 'he' else 'right' }}" style="color: var(--muted);"></i>
            </a>

            <!-- Change Email -->
            <a href="{{ url_for('change_email') }}" class="d-flex align-items-center p-3 text-decoration-none" style="background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.06)'; this.style.borderColor='rgba(59,130,246,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.03)'; this.style.borderColor='rgba(255,255,255,0.06)';">
              <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(96,165,250,0.1)); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                <i class="bi bi-envelope" style="font-size: 1.1rem; color: #60a5fa;"></i>
              </div>
              <div class="flex-grow-1">
                <div style="color: var(--text); font-weight: 500;">{% if current_lang == 'he' %}×©×™× ×•×™ ××™××™×™×œ{% elif current_lang == 'en' %}Change Email{% else %}Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ email{% endif %}</div>
                <small class="text-muted">{{ user.email }}</small>
              </div>
              <i class="bi bi-chevron-{{ 'left' if current_lang == 'he' else 'right' }}" style="color: var(--muted);"></i>
            </a>

            <!-- Saved Reports -->
            <a href="{{ url_for('saved_reports') }}" class="d-flex align-items-center p-3 text-decoration-none" style="background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.06); transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.06)'; this.style.borderColor='rgba(16,185,129,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.03)'; this.style.borderColor='rgba(255,255,255,0.06)';">
              <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(52,211,153,0.1)); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                <i class="bi bi-file-earmark-text" style="font-size: 1.1rem; color: #34d399;"></i>
              </div>
              <div class="flex-grow-1">
                <div style="color: var(--text); font-weight: 500;">{% if current_lang == 'he' %}×“×•×—×•×ª ×©××•×¨×™×{% elif current_lang == 'en' %}Saved Reports{% else %}Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹{% endif %}</div>
                <small class="text-muted">{% if current_lang == 'he' %}×¦×¤×” ×‘×“×•×—×•×ª ×©×œ×š{% elif current_lang == 'en' %}View your reports{% else %}ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ²Ğ°ÑˆĞ¸Ñ… Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¾Ğ²{% endif %}</small>
              </div>
              <i class="bi bi-chevron-{{ 'left' if current_lang == 'he' else 'right' }}" style="color: var(--muted);"></i>
            </a>

            <!-- Delete Account -->
            <a href="#" onclick="confirmDelete(); return false;" class="d-flex align-items-center p-2 text-decoration-none mt-2" style="background: transparent; border: none; transition: opacity 0.2s; opacity: 0.5;" onmouseover="this.style.opacity='0.7';" onmouseout="this.style.opacity='0.5';">
              <div style="width: 24px; height: 24px; border-radius: 6px; background: transparent; display: flex; align-items: center; justify-content: center; margin-right: 8px;">
                <i class="bi bi-trash" style="font-size: 0.75rem; color: var(--muted);"></i>
              </div>
              <div class="flex-grow-1">
                <small style="color: var(--muted); font-size: 0.75rem; font-weight: 400;">{% if current_lang == 'he' %}××—×™×§×ª ×—×©×‘×•×Ÿ{% elif current_lang == 'en' %}Delete Account{% else %}Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚{% endif %}</small>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
function confirmDelete() {
  const message = {% if current_lang == 'he' %}
    '×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×©×‘×•×Ÿ? ×¤×¢×•×œ×” ×–×• ×‘×œ×ª×™ ×”×¤×™×›×”!'
  {% elif current_lang == 'en' %}
    'Are you sure you want to delete your account? This action is irreversible!'
  {% else %}
    'Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚? Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾!'
  {% endif %};
  
  if (confirm(message)) {
    window.location.href = "{{ url_for('delete_account') }}";
  }
}
</script>
{% endblock %}
