{% extends "base.html" %}
{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-5">
      
      <div class="card" style="border: none; border-radius: 20px;">
        <div class="card-body p-4 p-md-5">
          
          <!-- Header -->
          <div class="text-center mb-4">
            <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: linear-gradient(135deg, rgba(26,188,156,0.2), rgba(46,160,255,0.15)); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
              <i class="bi bi-person-plus" style="font-size: 1.5rem; color: #1abc9c;"></i>
            </div>
            <h3 class="mb-1">יצירת חשבון</h3>
            <p class="text-muted small mb-0">הצטרף ל-OnePoweb בחינם</p>
          </div>

          <form method="POST" class="vstack gap-3" novalidate>
            
            <!-- Name Row -->
            <div class="row g-3">
              <div class="col-6">
                <label class="form-label">שם פרטי</label>
                <input name="first_name" class="form-control" value="{{ first_name or '' }}" required placeholder="ישראל">
              </div>
              <div class="col-6">
                <label class="form-label">שם משפחה</label>
                <input name="last_name" class="form-control" value="{{ last_name or '' }}" placeholder="ישראלי">
              </div>
            </div>
            
            <!-- Email -->
            <div>
              <label class="form-label">אימייל</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                <input name="email" type="email" class="form-control" value="{{ email or '' }}" required placeholder="your@email.com">
              </div>
              <div class="form-text small">נשלח אליך קישור לאימות</div>
            </div>
            
            <!-- Username -->
            <div>
              <label class="form-label">שם משתמש</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-at"></i></span>
                <input name="username" type="text" class="form-control" value="{{ username or '' }}" placeholder="myusername" pattern="^[A-Za-z0-9]{4,20}$" minlength="4" maxlength="20" required>
              </div>
              <div class="form-text small">4-20 תווים: אותיות אנגליות וספרות בלבד</div>
            </div>
            
            <!-- Password -->
            <div>
              <label class="form-label">סיסמה</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-lock"></i></span>
                <input name="password" type="password" class="form-control" id="password" minlength="8" maxlength="32" pattern="^(?=.*[A-Z])(?=.*[0-9])[A-Za-z0-9]{8,32}$" required placeholder="סיסמה חזקה">
              </div>
              <!-- Password Requirements -->
              <div class="mt-2 p-2" style="background: rgba(255,255,255,0.02); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05);">
                <div class="small text-muted mb-1">דרישות סיסמה:</div>
                <div class="d-flex flex-wrap gap-2">
                  <span class="badge" id="req-length" style="background: rgba(255,255,255,0.05); color: var(--muted); font-weight: normal;">8-32 תווים</span>
                  <span class="badge" id="req-english" style="background: rgba(255,255,255,0.05); color: var(--muted); font-weight: normal;">אותיות אנגליות בלבד</span>
                  <span class="badge" id="req-upper" style="background: rgba(255,255,255,0.05); color: var(--muted); font-weight: normal;">אות גדולה (A-Z)</span>
                  <span class="badge" id="req-digit" style="background: rgba(255,255,255,0.05); color: var(--muted); font-weight: normal;">ספרה (0-9)</span>
                </div>
              </div>
            </div>
            
            <!-- Confirm Password -->
            <div>
              <label class="form-label">אימות סיסמה</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                <input name="confirm_password" type="password" class="form-control" id="confirm_password" minlength="8" maxlength="32" required placeholder="הקלד שוב">
              </div>
              <div id="password-match" class="small mt-1" style="display: none;"></div>
            </div>
            
            <!-- Terms Checkbox -->
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="agree_terms" name="agree_terms" required>
              <label class="form-check-label small" for="agree_terms">
                אני מאשר/ת את <a href="{{ url_for('terms') }}" target="_blank">תנאי השימוש</a>
                ו<a href="{{ url_for('privacy') }}" target="_blank">מדיניות הפרטיות</a>
              </label>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100 py-2 mt-2" style="background: linear-gradient(90deg, #1abc9c, #16e0bd); border: none; border-radius: 12px; font-weight: 600;">
              <i class="bi bi-person-check me-2"></i>הרשמה
            </button>
          </form>
          
          <!-- Divider -->
          <div class="text-center my-4" style="position: relative;">
            <hr style="border-color: var(--border);">
            <span style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-soft); padding: 0 1rem; color: var(--muted); font-size: 0.85rem;">
              כבר יש לך חשבון?
            </span>
          </div>
          
          <!-- Login Link -->
          <a href="{{ url_for('login') }}" class="btn w-100" style="background: rgba(255,255,255,0.05); color: var(--text); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px;">
            <i class="bi bi-box-arrow-in-left me-2"></i>התחברות
          </a>
          
        </div>
      </div>
      
      <!-- Benefits -->
      <div class="text-center mt-4">
        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <div class="small text-muted">
            <i class="bi bi-check-circle text-success me-1"></i>7 ימי ניסיון חינם
          </div>
          <div class="small text-muted">
            <i class="bi bi-check-circle text-success me-1"></i>ללא כרטיס אשראי
          </div>
          <div class="small text-muted">
            <i class="bi bi-check-circle text-success me-1"></i>ביטול בכל עת
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const password = document.getElementById('password');
  const confirm = document.getElementById('confirm_password');
  const matchDiv = document.getElementById('password-match');
  
  const reqLength = document.getElementById('req-length');
  const reqEnglish = document.getElementById('req-english');
  const reqUpper = document.getElementById('req-upper');
  const reqDigit = document.getElementById('req-digit');
  
  const validStyle = 'background: rgba(16,185,129,0.2); color: #34d399;';
  const invalidStyle = 'background: rgba(255,255,255,0.05); color: var(--muted);';
  
  function validatePassword() {
    const val = password.value;
    
    // Length check (8-32)
    if (val.length >= 8 && val.length <= 32) {
      reqLength.style.cssText = validStyle;
    } else {
      reqLength.style.cssText = invalidStyle;
    }
    
    // English only
    if (/^[A-Za-z0-9]*$/.test(val) && val.length > 0) {
      reqEnglish.style.cssText = validStyle;
    } else {
      reqEnglish.style.cssText = invalidStyle;
    }
    
    // Uppercase
    if (/[A-Z]/.test(val)) {
      reqUpper.style.cssText = validStyle;
    } else {
      reqUpper.style.cssText = invalidStyle;
    }
    
    // Digit
    if (/[0-9]/.test(val)) {
      reqDigit.style.cssText = validStyle;
    } else {
      reqDigit.style.cssText = invalidStyle;
    }
    
    checkMatch();
  }
  
  function checkMatch() {
    if (confirm.value.length > 0) {
      matchDiv.style.display = 'block';
      if (password.value === confirm.value) {
        matchDiv.innerHTML = '<i class="bi bi-check-circle me-1"></i>הסיסמאות תואמות';
        matchDiv.style.color = '#34d399';
      } else {
        matchDiv.innerHTML = '<i class="bi bi-x-circle me-1"></i>הסיסמאות לא תואמות';
        matchDiv.style.color = '#f87171';
      }
    } else {
      matchDiv.style.display = 'none';
    }
  }
  
  password.addEventListener('input', validatePassword);
  confirm.addEventListener('input', checkMatch);
});
</script>
{% endblock %}
