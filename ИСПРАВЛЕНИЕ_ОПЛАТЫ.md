# Решение проблемы с оплатой PayPal

## Проблема
При нажатии на кнопку "Оплатить" появляется ошибка:
```
Payment error. Try again or contact us
```

## Причина
Система оплаты PayPal не настроена. Нужно добавить ваши учетные данные PayPal.

## Быстрое решение

### Шаг 1: Получите учетные данные PayPal

#### Для тестирования (Sandbox):
1. Откройте https://developer.paypal.com/
2. Войдите в аккаунт PayPal
3. Перейдите: **Dashboard** → **Apps & Credentials**
4. Вверху выберите режим: **Sandbox**
5. Нажмите **Create App** (или выберите существующее)
6. Скопируйте:
   - **Client ID** (начинается с `AX...`)
   - **Secret** (нажмите "Show" чтобы увидеть)

#### Для продакшена (Live):
- Те же шаги, но выберите режим **Live** вместо Sandbox

### Шаг 2: Добавьте учетные данные

#### Если работаете локально:

1. Создайте файл `.env` в корне проекта (рядом с `app.py`)
2. Добавьте туда:

```bash
PAYPAL_CLIENT_ID=ваш_client_id_сюда
PAYPAL_SECRET=ваш_secret_сюда
PAYPAL_MODE=sandbox
```

3. Сохраните файл
4. Перезапустите приложение (Ctrl+C и запустите снова)

#### Если приложение на Render.com:

1. Откройте https://dashboard.render.com/
2. Выберите ваш проект OnePoweb
3. Перейдите в **Environment**
4. Добавьте переменные:
   - Имя: `PAYPAL_CLIENT_ID`, Значение: ваш Client ID
   - Имя: `PAYPAL_SECRET`, Значение: ваш Secret  
   - Имя: `PAYPAL_MODE`, Значение: `sandbox` (или `live`)
5. Сохраните - приложение автоматически перезапустится

### Шаг 3: Проверьте работу

1. **Протестируйте настройку:**
   ```bash
   python test_paypal.py
   ```
   
   Должен вывести:
   ```
   ✅ НАСТРОЙКА PAYPAL УСПЕШНА!
   ```

2. **Попробуйте оплату:**
   - Откройте страницу оплаты в браузере
   - Должна появиться кнопка PayPal (синяя)
   - Нажмите на неё
   - Вы будете перенаправлены на страницу PayPal

### Шаг 4: Тестовая оплата (Sandbox)

В режиме Sandbox используйте тестовые аккаунты:

1. На https://developer.paypal.com/ перейдите в **Sandbox** → **Accounts**
2. Найдите тестовый аккаунт покупателя (Personal)
3. Используйте его email и пароль для тестовой оплаты

## Проверка логов

После настройки в логах приложения вы должны увидеть:

```
[PayPal] Creating subscription for plan: basic
[PayPal] Found existing product: PROD-...
[PayPal] Creating new plan: OnePoweb BASIC with price $19
[PayPal] Created plan: P-...
[PayPal] Response status: 201
```

Если видите ошибки:
```
[PayPal] Failed to get access token
[PayPal] PAYPAL_CLIENT_ID configured: False
```
→ Учетные данные не настроены или неправильные

```
[PayPal] Failed to get access token: 401 - ...
```
→ Неверный Client ID или Secret

## Важные моменты

✅ **Что уже сделано:**
- Улучшена обработка ошибок
- Добавлено подробное логирование
- Информативные сообщения об ошибках

❗ **Что нужно сделать:**
- Получить Client ID и Secret от PayPal
- Добавить их в переменные окружения
- Перезапустить приложение

## Дополнительные файлы

- `PAYPAL_SETUP.md` - подробная инструкция по настройке
- `ENV_SETUP.md` - пример настройки .env файла
- `test_paypal.py` - скрипт для проверки настройки

## Нужна помощь?

Если проблема не решается:
1. Запустите `python test_paypal.py` и отправьте результат
2. Проверьте логи приложения на наличие сообщений `[PayPal]`
3. Убедитесь, что в PayPal приложении включена функция "Subscriptions"







